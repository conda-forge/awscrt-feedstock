From d6d274d557c1cca16d73d3b534bfc0cb4a51add1 Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <uwe.korn@quantco.com>
Date: Thu, 10 Jun 2021 21:51:53 +0200
Subject: [PATCH 1/2] Use aws-* libs from PREFIX

---
 setup.py | 9 +--------
 1 file changed, 1 insertion(+), 8 deletions(-)

diff --git a/setup.py b/setup.py
index 1e7ce97..f4d0089 100644
--- a/setup.py
+++ b/setup.py
@@ -245,11 +245,6 @@ class awscrt_build_ext(setuptools.command.build_ext.build_ext):
         # build dependencies
         dep_build_dir = os.path.join(self.build_temp, 'deps')
         dep_install_path = os.path.join(self.build_temp, 'deps', 'install')
-        for lib in AWS_LIBS:
-            self._build_dependency(lib, dep_build_dir, dep_install_path)
-
-        # update paths so awscrt_ext can access dependencies
-        self.include_dirs.append(os.path.join(dep_install_path, 'include'))
 
         # some platforms (ex: fedora) use /lib64 instead of just /lib
         lib_dir = 'lib'
@@ -258,8 +253,6 @@ class awscrt_build_ext(setuptools.command.build_ext.build_ext):
         if is_32bit() and os.path.exists(os.path.join(dep_install_path, 'lib32')):
             lib_dir = 'lib32'
 
-        self.library_dirs.append(os.path.join(dep_install_path, lib_dir))
-
         # continue with normal build_ext.run()
         super().run()
 
@@ -289,7 +282,7 @@ def awscrt_ext():
     else:  # unix
         # linker will prefer shared libraries over static if it can find both.
         # force linker to choose static variant by using using "-l:libcrypto.a" syntax instead of just "-lcrypto".
-        libraries = [':lib{}.a'.format(x) for x in libraries]
+        libraries = ['{}'.format(x) for x in libraries]
         libraries += ['rt']
 
         # python usually adds -pthread automatically, but we've observed
-- 
2.35.3

